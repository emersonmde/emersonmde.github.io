{"componentChunkName":"component---src-templates-blog-post-js","path":"/1-billion-row-challenge-part-2/","result":{"data":{"site":{"siteMetadata":{"title":"Error Signal"}},"markdownRemark":{"id":"0496b13b-d356-5617-b607-a91389534196","excerpt":"I recently wrote about my solution to the\nThe 1 Billion Row Challenge, a challenge\nthat requires you to read 1 billion rows from a text file then calculate the…","html":"<p>I recently wrote about my solution to the\n<a href=\"../1-billion-row-challenge-part-1\">The 1 Billion Row Challenge</a>, a challenge\nthat requires you to read 1 billion rows from a text file then calculate the\nmin, max, and mean temperature readings for each weather station. The goal was\nto push modern Java's performance to the limit. I have been curious how a\nsimilar approach would perform in other languages or tools. While I won't be\naccurately benchmarking every solution, I am interested in the rough\ncomparison and what the final code would look like. With that out of the way,\nlet's dive into a real complied language - Rust.</p>\n<h2>Blazing Fast (TM)</h2>\n<p>I had an approach from the Java solution that I wanted to try to implement in\nRust: memory map the file, split it into chunks, process each chunk with a\nthread, then combine the results from each thread. With Rust I knew you can\ncustomize the hasher for a HashMap, so I wanted to try using a faster hasher\nthat did not need to be cryptographically secure. Finally, although SIMD\ndidn't dramatically improve performance in Java, I was hoping still building a\nvector would allow the compiler to optimize the min, max, and sum operations.</p>\n<p>With this in mind, I memory mapped the file:</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token keyword\">let</span> mmap <span class=\"token operator\">=</span> <span class=\"token keyword\">unsafe</span> <span class=\"token punctuation\">{</span> <span class=\"token class-name\">MmapOptions</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>file<span class=\"token punctuation\">)</span><span class=\"token operator\">?</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> mmap<span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span><span class=\"token lifetime-annotation symbol\">'static</span> <span class=\"token class-name\">Mmap</span> <span class=\"token operator\">=</span> <span class=\"token class-name\">Box</span><span class=\"token punctuation\">::</span><span class=\"token function\">leak</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Box</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span>mmap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Split the file into chunks:</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token keyword\">let</span> len <span class=\"token operator\">=</span> mmap<span class=\"token punctuation\">.</span><span class=\"token function\">len</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> num_chunks <span class=\"token operator\">=</span> <span class=\"token number\">4</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> chunk_size <span class=\"token operator\">=</span> len <span class=\"token operator\">/</span> num_chunks<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> <span class=\"token keyword\">mut</span> threads <span class=\"token operator\">=</span> <span class=\"token macro property\">vec!</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token number\">0</span><span class=\"token punctuation\">..</span>num_chunks <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> <span class=\"token keyword\">mut</span> start <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> <span class=\"token keyword\">mut</span> end <span class=\"token operator\">=</span> len<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// find the start and end adjusted to the nearest newline</span>\n    <span class=\"token keyword\">if</span> i <span class=\"token operator\">></span> <span class=\"token number\">0</span> <span class=\"token punctuation\">{</span>\n        start <span class=\"token operator\">=</span> mmap<span class=\"token punctuation\">.</span><span class=\"token function\">iter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">skip</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">*</span> chunk_size<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">position</span><span class=\"token punctuation\">(</span><span class=\"token closure-params\"><span class=\"token closure-punctuation punctuation\">|</span><span class=\"token operator\">&amp;</span>b<span class=\"token closure-punctuation punctuation\">|</span></span> b <span class=\"token operator\">==</span> <span class=\"token char\">b'\\n'</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">map_or</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">*</span> chunk_size<span class=\"token punctuation\">,</span> <span class=\"token closure-params\"><span class=\"token closure-punctuation punctuation\">|</span>pos<span class=\"token closure-punctuation punctuation\">|</span></span> i <span class=\"token operator\">*</span> chunk_size <span class=\"token operator\">+</span> pos <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">if</span> i <span class=\"token operator\">&lt;</span> num_chunks <span class=\"token operator\">-</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">{</span>\n        end <span class=\"token operator\">=</span> mmap<span class=\"token punctuation\">.</span><span class=\"token function\">iter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">skip</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> chunk_size<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">position</span><span class=\"token punctuation\">(</span><span class=\"token closure-params\"><span class=\"token closure-punctuation punctuation\">|</span><span class=\"token operator\">&amp;</span>b<span class=\"token closure-punctuation punctuation\">|</span></span> b <span class=\"token operator\">==</span> <span class=\"token char\">b'\\n'</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">map_or</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> chunk_size<span class=\"token punctuation\">,</span> <span class=\"token closure-params\"><span class=\"token closure-punctuation punctuation\">|</span>pos<span class=\"token closure-punctuation punctuation\">|</span></span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> chunk_size <span class=\"token operator\">+</span> pos <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">let</span> handle <span class=\"token operator\">=</span> <span class=\"token namespace\">thread<span class=\"token punctuation\">::</span></span><span class=\"token function\">spawn</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">move</span> <span class=\"token closure-params\"><span class=\"token closure-punctuation punctuation\">|</span><span class=\"token closure-punctuation punctuation\">|</span></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> chunk <span class=\"token operator\">=</span> <span class=\"token operator\">&amp;</span>mmap<span class=\"token punctuation\">[</span>start<span class=\"token punctuation\">..</span>end<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        \n        <span class=\"token comment\">// ...</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>With each chunk setup, I then parsed each line and added them to a HashMap\nusing the <code class=\"language-text\">ahash</code> crate:</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token keyword\">let</span> <span class=\"token keyword\">mut</span> map<span class=\"token punctuation\">:</span> <span class=\"token class-name\">AHashMap</span><span class=\"token operator\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Vec</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">f64</span><span class=\"token operator\">>></span> <span class=\"token operator\">=</span> <span class=\"token class-name\">AHashMap</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nchunk<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token closure-params\"><span class=\"token closure-punctuation punctuation\">|</span><span class=\"token operator\">&amp;</span>b<span class=\"token closure-punctuation punctuation\">|</span></span> b <span class=\"token operator\">==</span> <span class=\"token char\">b'\\n'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">for_each</span><span class=\"token punctuation\">(</span><span class=\"token closure-params\"><span class=\"token closure-punctuation punctuation\">|</span>line<span class=\"token closure-punctuation punctuation\">|</span></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> line<span class=\"token punctuation\">.</span><span class=\"token function\">is_empty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">if</span> <span class=\"token keyword\">let</span> <span class=\"token class-name\">Some</span><span class=\"token punctuation\">(</span>separator_index<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> line<span class=\"token punctuation\">.</span><span class=\"token function\">iter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">position</span><span class=\"token punctuation\">(</span><span class=\"token closure-params\"><span class=\"token closure-punctuation punctuation\">|</span><span class=\"token operator\">&amp;</span>b<span class=\"token closure-punctuation punctuation\">|</span></span> b <span class=\"token operator\">==</span> <span class=\"token char\">b';'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> <span class=\"token punctuation\">(</span>station<span class=\"token punctuation\">,</span> temp_with_separator<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> line<span class=\"token punctuation\">.</span><span class=\"token function\">split_at</span><span class=\"token punctuation\">(</span>separator_index<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">let</span> temp <span class=\"token operator\">=</span> <span class=\"token operator\">&amp;</span>temp_with_separator<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Skip the separator itself</span>\n\n        <span class=\"token keyword\">let</span> station_name <span class=\"token operator\">=</span> <span class=\"token namespace\">std<span class=\"token punctuation\">::</span></span><span class=\"token keyword\">str</span><span class=\"token punctuation\">::</span><span class=\"token function\">from_utf8</span><span class=\"token punctuation\">(</span>station<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">unwrap_or_default</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">let</span> temperature_str <span class=\"token operator\">=</span> <span class=\"token namespace\">std<span class=\"token punctuation\">::</span></span><span class=\"token keyword\">str</span><span class=\"token punctuation\">::</span><span class=\"token function\">from_utf8</span><span class=\"token punctuation\">(</span>temp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">unwrap_or_default</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token keyword\">let</span> <span class=\"token class-name\">Ok</span><span class=\"token punctuation\">(</span>temperature<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> temperature_str<span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">::</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">f64</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            map<span class=\"token punctuation\">.</span><span class=\"token function\">entry</span><span class=\"token punctuation\">(</span>station_name<span class=\"token punctuation\">.</span><span class=\"token function\">to_string</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">or_insert</span><span class=\"token punctuation\">(</span><span class=\"token macro property\">vec!</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>temperature<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Calculated the min, max, sum and count for each station and return it\nas a HashMap:</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token keyword\">let</span> <span class=\"token keyword\">mut</span> calculation_map <span class=\"token operator\">=</span> <span class=\"token class-name\">AHashMap</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// ...</span>\n\n<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>station<span class=\"token punctuation\">,</span> temperatures<span class=\"token punctuation\">)</span> <span class=\"token keyword\">in</span> map<span class=\"token punctuation\">.</span><span class=\"token function\">iter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> <span class=\"token keyword\">mut</span> min <span class=\"token operator\">=</span> <span class=\"token keyword\">f64</span><span class=\"token punctuation\">::</span><span class=\"token constant\">MAX</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> <span class=\"token keyword\">mut</span> max <span class=\"token operator\">=</span> <span class=\"token keyword\">f64</span><span class=\"token punctuation\">::</span><span class=\"token constant\">MIN</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> <span class=\"token keyword\">mut</span> sum <span class=\"token operator\">=</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">for</span> <span class=\"token operator\">&amp;</span>temperature <span class=\"token keyword\">in</span> temperatures <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> temperature <span class=\"token operator\">&lt;</span> min <span class=\"token punctuation\">{</span>\n            min <span class=\"token operator\">=</span> temperature<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">if</span> temperature <span class=\"token operator\">></span> max <span class=\"token punctuation\">{</span>\n            max <span class=\"token operator\">=</span> temperature<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        sum <span class=\"token operator\">+=</span> temperature<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token comment\">// let min = temperatures.iter().fold(f64::MAX, |a, &amp;b| a.min(b));</span>\n    <span class=\"token comment\">// let max = temperatures.iter().fold(f64::MIN, |a, &amp;b| a.max(b));</span>\n    <span class=\"token comment\">// let sum: f64 = temperatures.iter().sum();</span>\n    <span class=\"token keyword\">let</span> len <span class=\"token operator\">=</span> temperatures<span class=\"token punctuation\">.</span><span class=\"token function\">len</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    calculation_map<span class=\"token punctuation\">.</span><span class=\"token function\">insert</span><span class=\"token punctuation\">(</span>\n        station<span class=\"token punctuation\">.</span><span class=\"token function\">to_string</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token class-name\">CalculationResult</span> <span class=\"token punctuation\">{</span> min<span class=\"token punctuation\">,</span> max<span class=\"token punctuation\">,</span> sum<span class=\"token punctuation\">,</span> len <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Then finally, combine the results from each thread:</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">combine_maps</span><span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">mut</span> map1<span class=\"token punctuation\">:</span> <span class=\"token class-name\">AHashMap</span><span class=\"token operator\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">CalculationResult</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n    map2<span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span><span class=\"token class-name\">AHashMap</span><span class=\"token operator\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">CalculationResult</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> <span class=\"token class-name\">AHashMap</span><span class=\"token operator\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">CalculationResult</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">)</span> <span class=\"token keyword\">in</span> map2 <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> entry <span class=\"token operator\">=</span> map1<span class=\"token punctuation\">.</span><span class=\"token function\">entry</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">.</span><span class=\"token function\">into</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">or_insert</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">CalculationResult</span> <span class=\"token punctuation\">{</span>\n            min<span class=\"token punctuation\">:</span> <span class=\"token keyword\">f64</span><span class=\"token punctuation\">::</span><span class=\"token constant\">MAX</span><span class=\"token punctuation\">,</span>\n            max<span class=\"token punctuation\">:</span> <span class=\"token keyword\">f64</span><span class=\"token punctuation\">::</span><span class=\"token constant\">MIN</span><span class=\"token punctuation\">,</span>\n            sum<span class=\"token punctuation\">:</span> <span class=\"token number\">0.0</span><span class=\"token punctuation\">,</span>\n            len<span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        entry<span class=\"token punctuation\">.</span>min <span class=\"token operator\">=</span> entry<span class=\"token punctuation\">.</span>min<span class=\"token punctuation\">.</span><span class=\"token function\">min</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">.</span>min<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        entry<span class=\"token punctuation\">.</span>max <span class=\"token operator\">=</span> entry<span class=\"token punctuation\">.</span>max<span class=\"token punctuation\">.</span><span class=\"token function\">max</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">.</span>max<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        entry<span class=\"token punctuation\">.</span>sum <span class=\"token operator\">+=</span> value<span class=\"token punctuation\">.</span>sum<span class=\"token punctuation\">;</span>\n        entry<span class=\"token punctuation\">.</span>len <span class=\"token operator\">+=</span> value<span class=\"token punctuation\">.</span>len<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    map1\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token keyword\">let</span> <span class=\"token keyword\">mut</span> results <span class=\"token operator\">=</span> <span class=\"token class-name\">Vec</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">for</span> handle <span class=\"token keyword\">in</span> threads <span class=\"token punctuation\">{</span>\n    results<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>handle<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">unwrap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token macro property\">println!</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Thread finished\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">let</span> results <span class=\"token operator\">=</span> results<span class=\"token punctuation\">.</span><span class=\"token function\">iter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">fold</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">AHashMap</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> combine_maps<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<h2>To Infinity</h2>\n<p>Turns out it didn't even finish. I let it run for a few minutes before\nassuming there was an infinite loop or deadlock and killed it. After\nre-reading the code I quickly realized this was just a simple oversight. It\nwas obvious once I thought about how the HashMap was being updated. The\n<code class=\"language-text\">f64</code> was being added to the <code class=\"language-text\">Vec&lt;f64></code> for every line, duplicating the memory\nthat was already being read. The worst part was since <code class=\"language-text\">Vec</code> is a dynamic\narray, it was constantly being sized up requiring a new array to be allocated\nand the data to be painstakingly copied over.</p>\n<h2>A New Hope</h2>\n<p>I decided to forget about SIMD and compiler optimizations for\nnow and change this implementation to more closely match the Java solution.\nThis time each thread would update the min, max, sum, and count for each\ntemperature value parsed:</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token keyword\">let</span> handle <span class=\"token operator\">=</span> <span class=\"token namespace\">thread<span class=\"token punctuation\">::</span></span><span class=\"token function\">spawn</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">move</span> <span class=\"token closure-params\"><span class=\"token closure-punctuation punctuation\">|</span><span class=\"token closure-punctuation punctuation\">|</span></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> chunk <span class=\"token operator\">=</span> <span class=\"token operator\">&amp;</span>mmap<span class=\"token punctuation\">[</span>start<span class=\"token punctuation\">..</span>end<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">let</span> <span class=\"token keyword\">mut</span> map<span class=\"token punctuation\">:</span> <span class=\"token class-name\">AHashMap</span><span class=\"token operator\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">CalculationResult</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token class-name\">AHashMap</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    chunk<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token closure-params\"><span class=\"token closure-punctuation punctuation\">|</span><span class=\"token operator\">&amp;</span>b<span class=\"token closure-punctuation punctuation\">|</span></span> b <span class=\"token operator\">==</span> <span class=\"token char\">b'\\n'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">for_each</span><span class=\"token punctuation\">(</span><span class=\"token closure-params\"><span class=\"token closure-punctuation punctuation\">|</span>line<span class=\"token closure-punctuation punctuation\">|</span></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> line<span class=\"token punctuation\">.</span><span class=\"token function\">is_empty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">if</span> <span class=\"token keyword\">let</span> <span class=\"token class-name\">Some</span><span class=\"token punctuation\">(</span>separator_index<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> line<span class=\"token punctuation\">.</span><span class=\"token function\">iter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">position</span><span class=\"token punctuation\">(</span><span class=\"token closure-params\"><span class=\"token closure-punctuation punctuation\">|</span><span class=\"token operator\">&amp;</span>b<span class=\"token closure-punctuation punctuation\">|</span></span> b <span class=\"token operator\">==</span> <span class=\"token char\">b';'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">let</span> <span class=\"token punctuation\">(</span>station<span class=\"token punctuation\">,</span> temp_with_separator<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> line<span class=\"token punctuation\">.</span><span class=\"token function\">split_at</span><span class=\"token punctuation\">(</span>separator_index<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">let</span> temp <span class=\"token operator\">=</span> <span class=\"token operator\">&amp;</span>temp_with_separator<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Skip the separator itself</span>\n\n            <span class=\"token keyword\">let</span> station_name <span class=\"token operator\">=</span> <span class=\"token namespace\">std<span class=\"token punctuation\">::</span></span><span class=\"token keyword\">str</span><span class=\"token punctuation\">::</span><span class=\"token function\">from_utf8</span><span class=\"token punctuation\">(</span>station<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">unwrap_or_default</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">let</span> temperature_str <span class=\"token operator\">=</span> <span class=\"token namespace\">std<span class=\"token punctuation\">::</span></span><span class=\"token keyword\">str</span><span class=\"token punctuation\">::</span><span class=\"token function\">from_utf8</span><span class=\"token punctuation\">(</span>temp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">unwrap_or_default</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">if</span> <span class=\"token keyword\">let</span> <span class=\"token class-name\">Ok</span><span class=\"token punctuation\">(</span>temperature<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> temperature_str<span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">::</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">f64</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                map<span class=\"token punctuation\">.</span><span class=\"token function\">entry</span><span class=\"token punctuation\">(</span>station_name<span class=\"token punctuation\">.</span><span class=\"token function\">to_string</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">.</span><span class=\"token function\">and_modify</span><span class=\"token punctuation\">(</span><span class=\"token closure-params\"><span class=\"token closure-punctuation punctuation\">|</span>e<span class=\"token closure-punctuation punctuation\">|</span></span> <span class=\"token punctuation\">{</span>\n                        e<span class=\"token punctuation\">.</span>min <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>min<span class=\"token punctuation\">.</span><span class=\"token function\">min</span><span class=\"token punctuation\">(</span>temperature<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        e<span class=\"token punctuation\">.</span>max <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>max<span class=\"token punctuation\">.</span><span class=\"token function\">max</span><span class=\"token punctuation\">(</span>temperature<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        e<span class=\"token punctuation\">.</span>sum <span class=\"token operator\">+=</span> temperature<span class=\"token punctuation\">;</span>\n                        e<span class=\"token punctuation\">.</span>len <span class=\"token operator\">+=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">.</span><span class=\"token function\">or_insert</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">CalculationResult</span> <span class=\"token punctuation\">{</span>\n                        min<span class=\"token punctuation\">:</span> temperature<span class=\"token punctuation\">,</span>\n                        max<span class=\"token punctuation\">:</span> temperature<span class=\"token punctuation\">,</span>\n                        sum<span class=\"token punctuation\">:</span> temperature<span class=\"token punctuation\">,</span>\n                        len<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    map\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>The Race Is On</h2>\n<p>After the updates, running the program resulted in processing all 1 billion\nrows in just 22 seconds, almost a 30% improvement over the previous Java\nsolution.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">Benchmark <span class=\"token number\">1</span>: target/release/brc-rs\n  Time <span class=\"token punctuation\">(</span>mean ± σ<span class=\"token punctuation\">)</span>:     <span class=\"token number\">21.586</span> s ±  <span class=\"token number\">0.245</span> s    <span class=\"token punctuation\">[</span>User: <span class=\"token number\">84.719</span> s, System: <span class=\"token number\">18.306</span> s<span class=\"token punctuation\">]</span>\n  Range <span class=\"token punctuation\">(</span>min … max<span class=\"token punctuation\">)</span>:   <span class=\"token number\">21.269</span> s … <span class=\"token number\">21.984</span> s    <span class=\"token number\">10</span> runs</code></pre></div>\n<p>This got me thinking, 22 seconds is pretty good for a first try (who's\ncounting anyway?) but there are entire software companies and projects\ndedicated to loading and processing data as fast as possible. A database like\nPostgres has had hundreds of engineers carefully optimizing it over decades.\nAlthough supporting more general workloads has its overhead, I figured loading\na CSV and calculating the min, max, and mean would be its bread and butter.\nHow naive I was...</p>\n<h2>Postgres</h2>\n<p>I haven't used Postgres in years, but I'm sure ChatGPT can pick up the slack.\nFirst was getting it installed and the table created.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">brew <span class=\"token function\">install</span> postgres\nbrew services start postgresql</code></pre></div>\n<p>With Postgres installed I created the database and table.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">psql <span class=\"token parameter variable\">-h</span> localhost <span class=\"token parameter variable\">-d</span> <span class=\"token string\">\"postgres\"</span> <span class=\"token parameter variable\">-c</span> <span class=\"token string\">\"CREATE DATABASE challenge;\"</span>\npsql <span class=\"token parameter variable\">-h</span> localhost <span class=\"token parameter variable\">-d</span> <span class=\"token string\">\"challenge\"</span> <span class=\"token parameter variable\">-c</span> \"CREATE TABLE IF NOT EXISTS measurements <span class=\"token punctuation\">(</span>station_name VARCHAR<span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span>, temperature DECIMAL<span class=\"token punctuation\">(</span><span class=\"token number\">3,1</span><span class=\"token punctuation\">))</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Then load the measurements!</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">time</span> psql <span class=\"token parameter variable\">-h</span> localhost <span class=\"token parameter variable\">-d</span> <span class=\"token string\">\"challenge\"</span> <span class=\"token parameter variable\">-c</span> <span class=\"token string\">\"<span class=\"token entity\" title=\"\\c\">\\c</span>opy measurements(station_name, temperature) FROM 'measurements.txt' DELIMITER ';' CSV;\"</span></code></pre></div>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/754a568e10ca118ef0b865c9403eb5b7/80e3c/patiently_waiting.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 98.73417721518987%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAMEBQL/xAAWAQEBAQAAAAAAAAAAAAAAAAABAgD/2gAMAwEAAhADEAAAAbEVS1J2gJlb43MJ3//EABwQAAICAgMAAAAAAAAAAAAAAAECAxIAEQQQIv/aAAgBAQABBQLV1HlcEj5WR1pP1w2JG6j/xAAVEQEBAAAAAAAAAAAAAAAAAAARIP/aAAgBAwEBPwEj/8QAFREBAQAAAAAAAAAAAAAAAAAAEAH/2gAIAQIBAT8BKf/EABsQAAIDAQEBAAAAAAAAAAAAAAABAhEhEDFB/9oACAEBAAY/AtZXFvopKSMlDlfEij//xAAcEAACAgIDAAAAAAAAAAAAAAAAAREhUXExkcH/2gAIAQEAAT8huqBRcFZ+SWxS24S5qiqH6hGCccDsoJD3s//aAAwDAQACAAMAAAAQTCi+/8QAGBEBAQADAAAAAAAAAAAAAAAAAQARMXH/2gAIAQMBAT8QWcsTGr//xAAZEQACAwEAAAAAAAAAAAAAAAAAAREhQTH/2gAIAQIBAT8QqI0SMD6f/8QAHhABAAIDAAIDAAAAAAAAAAAAAQARITFBUWFxkcH/2gAIAQEAAT8Qqk3hbJ4JRoG1HMwyRfuEUkopediwkizfWyW9L4PyLdOQqwgcPaWKhls25U//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Patiently Waiting Meme\"\n        title=\" \"\n        src=\"/static/754a568e10ca118ef0b865c9403eb5b7/828fb/patiently_waiting.jpg\"\n        srcset=\"/static/754a568e10ca118ef0b865c9403eb5b7/ff44c/patiently_waiting.jpg 158w,\n/static/754a568e10ca118ef0b865c9403eb5b7/a6688/patiently_waiting.jpg 315w,\n/static/754a568e10ca118ef0b865c9403eb5b7/828fb/patiently_waiting.jpg 630w,\n/static/754a568e10ca118ef0b865c9403eb5b7/80e3c/patiently_waiting.jpg 720w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\"> </figcaption>\n  </figure></p>\n<p>I knew it wasn't going to be that easy. After about 10 minutes my hard drive\nfilled up. Granted I only had 40 GB free when I started this process, 10\nminutes was still significantly worse than what I was expecting. After\ncleaning up some unused data I noticed many write-ahead-logs in the Postgres\ndirectory. To prevent logging on this table, I changed the <code class=\"language-text\">CREATE TABLE</code>\ncommand to <code class=\"language-text\">CREATE UNLOGGED TABLE</code>. I also asked ChatGPT what settings I could\ntweak to get better performance loading which recommended setting the\n<code class=\"language-text\">max_parallel_workers_per_gather</code>. When going to set this I saw some other\nworker counts and set them all to 10. This would probably cause an issue in a\nproduction database, but thankfully the load process and query process would\nbe isolated.</p>\n<div class=\"gatsby-highlight\" data-language=\"txt\"><pre class=\"language-txt\"><code class=\"language-txt\">max_worker_processes = 10\t\t# (change requires restart)\nmax_parallel_workers_per_gather = 10\t# taken from max_parallel_workers\nmax_parallel_maintenance_workers = 10\t# taken from max_parallel_workers\nmax_parallel_workers = 10\t\t# maximum number of max_worker_processes that</code></pre></div>\n<h2>Crunch The Numbers</h2>\n<p>In addition to the <code class=\"language-text\">postgres.conf</code> settings, I set <code class=\"language-text\">maintenance_work_mem</code>\nfor good measure. With that I started copying the data:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">time</span> <span class=\"token punctuation\">(</span>psql <span class=\"token parameter variable\">-h</span> localhost <span class=\"token parameter variable\">-d</span> <span class=\"token string\">\"challenge\"</span> <span class=\"token parameter variable\">-c</span> <span class=\"token string\">\"SET maintenance_work_mem = '8GB';\"</span> <span class=\"token operator\">&amp;&amp;</span> psql <span class=\"token parameter variable\">-h</span> localhost <span class=\"token parameter variable\">-d</span> <span class=\"token string\">\"challenge\"</span> <span class=\"token parameter variable\">-c</span> <span class=\"token string\">\"<span class=\"token entity\" title=\"\\c\">\\c</span>opy measurements(station_name, temperature) FROM 'measurements.txt' DELIMITER ';' CSV;\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>The full load took 5 minutes and 2 seconds and used 45GB of disk space.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">SET\nCOPY <span class=\"token number\">1000000000</span>\n<span class=\"token punctuation\">(</span> psql <span class=\"token parameter variable\">-h</span> localhost <span class=\"token parameter variable\">-d</span> <span class=\"token string\">\"challenge\"</span> <span class=\"token parameter variable\">-c</span> <span class=\"token string\">\"SET maintenance_work_mem = '1GB';\"</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">)</span>\n<span class=\"token number\">118</span>.77s user <span class=\"token number\">16</span>.68s system <span class=\"token number\">44</span>% cpu <span class=\"token number\">5</span>:02.16 total</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">du</span> <span class=\"token parameter variable\">-ha</span> /opt/homebrew/var/postgresql@14 <span class=\"token operator\">|</span> <span class=\"token function\">sort</span> <span class=\"token parameter variable\">-h</span>\n<span class=\"token punctuation\">[</span><span class=\"token punctuation\">..</span>.<span class=\"token punctuation\">]</span>\n 45G\t/opt/homebrew/var/postgresql@14</code></pre></div>\n<p>This was already many times slower than either of the previous solutions, but\nhow long does the calculation actually take now the data is Postgres?</p>\n<div class=\"gatsby-highlight\" data-language=\"txt\"><pre class=\"language-txt\"><code class=\"language-txt\">time psql -h localhost -d \"challenge\" -P pager=off -c \"SELECT station_name, ROUND(MIN(temperature), 1) AS min_temp, ROUND(AVG(temperature), 1) AS mean_temp, ROUND(MAX(temperature), 1) AS max_temp FROM measurements GROUP BY station_name ORDER BY station_name;\"\n\npsql -h localhost -d \"challenge\" -P pager=off -c   0.01s user 0.02s system 0% cpu 1:13.08 total</code></pre></div>\n<p>The <code class=\"language-text\">SELECT</code> takes just over a minute to run. This makes sense thinking about\nall of the extra overhead Postgres needs to construct the table and query it.\nEach record needs to be saved in a fixed length format including updating all\nthe metadata for the table and Postgres internals. Then the entire table needs\nto be scanned, reading from disk, while preforming arbitrary calculations over\nthe data. It's pretty impressive this can still be done in just about a minute!</p>\n<h2>Conclusion</h2>\n<p>As expected the Rust solution ended up being the fastest of the three I tried.\nHowever it was surprising that there wasn't that much difference between the\nRust and Java version, a real testament to all of the work that has gone into\noptimizing modern JVM implementations. The results from Postgres were\nsurprising in a few different ways. I was expecting loading the data\nefficiently would have been far easier than it turned to out be and I was\nsurprised the final <code class=\"language-text\">SELECT</code> wasn't faster. The upside to the Postgres\nsolution was it took me a fraction of the time of the others.</p>\n<p>All in all this was a really fun project. I've learned a ton about the\nperformance characteristics of Java and a ton of tricks to optimize\nand test a program's performance.</p>","frontmatter":{"title":"The 1 Billion Row Challenge - Part 2","date":"February 17, 2024","description":"Revisiting the 1 billion row challenge with Rust and Postgres."}},"previous":{"fields":{"slug":"/plausible-analytics/"},"frontmatter":{"title":"Plausible Analytics"}},"next":null},"pageContext":{"id":"0496b13b-d356-5617-b607-a91389534196","previousPostId":"718d45ee-875b-584e-ae17-0d533295a510","nextPostId":null}},"staticQueryHashes":["1324386404","3257411868"],"slicesMap":{}}